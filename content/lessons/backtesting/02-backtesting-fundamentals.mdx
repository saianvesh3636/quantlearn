---
title: Backtesting Fundamentals
module: backtesting
order: 2
colabUrl: "https://colab.research.google.com/github/saianvesh3636/quantlearn/blob/main/notebooks/backtesting/02-backtesting-fundamentals.ipynb"
prerequisites:
  - backtesting/01-scientific-method
---

# Backtesting Fundamentals

Backtesting simulates how a strategy would have performed historically. It's our primary tool for strategy evaluation - but it's easy to do wrong.

<WhyItMatters tldr="A backtest showing 100% annual returns probably has bugs. A backtest showing 15% annual returns with realistic costs might actually work. Understanding the difference saves you from losing real money on fake strategies.">
Backtesting is where most quant traders make their biggest mistakes. It's trivially easy to create a backtest that shows amazing returns - and almost impossible to know if those returns are real or artifacts of bugs, biases, and wishful thinking. The strategies that look best in backtest often perform worst in live trading. Learning to backtest properly is learning to be skeptical of your own work.
</WhyItMatters>

<ConceptCard title="What is Backtesting?" type="definition">
**Backtesting** applies trading rules to historical data to see what returns would have been generated. It answers: "If I had traded this strategy from 2010-2020, what would have happened?"
</ConceptCard>

## The Backtesting Loop

<FormulaDisplay
  formula="PnL_t = Position_{t-1} \times (Price_t - Price_{t-1})"
  explanation="Daily profit/loss from holding a position."
  variables={[
    { symbol: "PnL_t", meaning: "Profit/Loss on day t" },
    { symbol: "Position_{t-1}", meaning: "Position size (shares/contracts)" },
    { symbol: "Price_t", meaning: "Today's price" }
  ]}
/>

<InteractiveExample title="Backtest Results" description="A sample strategy equity curve with key metrics">
  <EquityCurve
    data={[
      { date: "2020-01", equity: 100000, drawdown: 0 },
      { date: "2020-03", equity: 95000, drawdown: -5 },
      { date: "2020-06", equity: 110000, drawdown: 0 },
      { date: "2020-09", equity: 108000, drawdown: -1.8 },
      { date: "2020-12", equity: 125000, drawdown: 0 },
      { date: "2021-03", equity: 118000, drawdown: -5.6 },
      { date: "2021-06", equity: 140000, drawdown: 0 },
      { date: "2021-09", equity: 135000, drawdown: -3.6 },
      { date: "2021-12", equity: 155000, drawdown: 0 },
      { date: "2022-03", equity: 145000, drawdown: -6.5 },
      { date: "2022-06", equity: 160000, drawdown: 0 },
      { date: "2022-09", equity: 175000, drawdown: 0 }
    ]}
    title="Strategy Equity Curve (2020-2022)"
  />
</InteractiveExample>

## Key Metrics

<ConceptCard title="Essential Backtest Metrics" type="tip">
- **Total Return**: Overall profit/loss percentage
- **CAGR**: Compound Annual Growth Rate
- **Sharpe Ratio**: Risk-adjusted return (target > 1.5)
- **Max Drawdown**: Worst peak-to-trough decline
- **Win Rate**: Percentage of winning trades
- **Profit Factor**: Gross profit / Gross loss
</ConceptCard>

## Realistic Assumptions

<ConceptCard title="Transaction Costs" type="warning">
Always include:
- **Commissions**: Per-trade fees
- **Slippage**: Difference between expected and actual execution price
- **Spread**: Bid-ask cost
- **Market Impact**: Price movement from your own orders

A strategy with 0.5% annual return before costs often has -2% return after costs!
</ConceptCard>

<InteractiveExample title="Impact of Transaction Costs" description="Same strategy with different cost assumptions">
  <LineChart
    data={[
      { x: 0, y: 100, y2: 100, y3: 100 },
      { x: 1, y: 115, y2: 112, y3: 108 },
      { x: 2, y: 132, y2: 125, y3: 116 },
      { x: 3, y: 152, y2: 140, y3: 125 },
      { x: 4, y: 175, y2: 156, y3: 135 },
      { x: 5, y: 201, y2: 174, y3: 146 }
    ]}
    xLabel="Years"
    yLabel="Portfolio Value ($K)"
    title="Transaction Cost Impact Over Time"
    series={[
      { key: "y", name: "No Costs", color: "#10b981" },
      { key: "y2", name: "Low Costs (0.1%)", color: "#f59e0b" },
      { key: "y3", name: "High Costs (0.5%)", color: "#ef4444" }
    ]}
  />
</InteractiveExample>

<RealWorldExample
  title="Quantopian: 888 Backtests, Zero Predictive Power"
  date="2011-2020"
  impact="Platform shut down after backtested strategies failed live"
  sources={[
    { name: "Quantopian Blog - Research Findings" },
    { name: "Journal of Financial Data Science" }
  ]}
  lesson="Backtested Sharpe ratios have almost no correlation with live trading performance. The more you optimize, the worse the relationship gets."
>
Quantopian was a platform where users could develop and backtest trading strategies. They conducted extensive research on 888 algorithms:

**The finding was devastating:**
- Backtested Sharpe ratios had **near-zero correlation** with live paper trading results
- Strategies that looked best in backtest often performed worst live
- The more parameters a strategy had, the worse the live/backtest gap

**Why this happened:**
- Overfitting to historical data
- Survivorship bias in stock selection
- Transaction cost underestimation
- Look-ahead bias in data handling

**The outcome:** Quantopian shut down its crowd-sourced hedge fund in 2020. The lesson: a good backtest is necessary but not sufficient. Most backtested strategies fail in live trading.
</RealWorldExample>

<RealWorldExample
  title="The Hidden Cost: Market Impact"
  date="Ongoing"
  impact="Can turn profitable strategies unprofitable"
  sources={[
    { name: "Journal of Portfolio Management" },
    { name: "Two Sigma Research" }
  ]}
  lesson="Your own trading moves the market. Backtests that ignore this systematically overstate returns."
>
When you trade, you affect prices:
- **Buying** pushes prices up (you pay more than the current quote)
- **Selling** pushes prices down (you receive less than the current quote)

**Real-world example:**
A strategy trading $1M in a stock with $50M daily volume might see:
- Estimated slippage: 0.05-0.1% per trade
- Annual turnover: 500% (many trades)
- Hidden cost: 2.5-5% annually - often more than the strategy's edge

**The trap:** Backtests use historical prices as if you could trade at those exact prices. In reality, your own orders would have moved those prices. The bigger your positions, the worse this problem gets.

**AQR's research:** Many strategies that work at $10M stop working at $100M and become money-losers at $1B, purely due to market impact.
</RealWorldExample>

<KeyTakeaway>
A backtest is only as good as its assumptions. Always use **realistic transaction costs**, account for **slippage**, and remember that past performance doesn't guarantee future results. The goal is to avoid obviously bad strategies, not to predict exact future returns.
</KeyTakeaway>

<FindYourEdge
  concept="Realistic Backtesting"
  strategies={[
    {
      name: "Conservative Cost Assumptions",
      description: "Use 2x your estimated transaction costs. If the strategy still works, it might be real. If it doesn't, you've saved yourself from a losing strategy.",
      implementation: "Estimate realistic costs: commissions + spread + slippage + market impact. Double this estimate. Run backtest with inflated costs. Only proceed if still profitable.",
      parameters: "Retail: 0.1-0.2% round-trip for liquid stocks. Add 0.05-0.1% for slippage. Double total for safety margin.",
      evidence: "AQR research shows many strategies that work at $10M fail at $100M due to market impact. Being conservative on costs is the cheapest form of robustness testing.",
      risks: "You'll reject some strategies that might have worked. Overly conservative assumptions may cause you to miss opportunities. But false negatives are much cheaper than false positives."
    },
    {
      name: "Capacity-Constrained Position Sizing",
      description: "Limit position size based on daily volume to avoid market impact that wasn't in your backtest.",
      implementation: "Calculate average daily volume (ADV) for each stock. Limit position to 1-2% of ADV. If your strategy requires larger positions, expect worse execution than backtest shows.",
      parameters: "Max position = 1% of 20-day average daily volume. For $100K portfolio in stock with $10M ADV, max position = $100K (1% Ã— $10M).",
      evidence: "Two Sigma, AQR, and other institutional quants all model capacity constraints. Ignoring capacity is the #1 reason retail backtests don't replicate.",
      risks: "Limits the size you can trade, potentially reducing absolute returns. May force you to trade more stocks (diversification cost). Requires ongoing monitoring of liquidity."
    }
  ]}
/>

<ThinkAboutIt questions={[
  {
    question: "Your backtest shows 50% annual returns. What's your first reaction?",
    hint: "Skepticism. 50% annual returns would make you one of the best traders in history. More likely: there's a bug, lookahead bias, survivorship bias, or unrealistic cost assumptions. Check for errors before getting excited."
  },
  {
    question: "A strategy has a Sharpe ratio of 2.5 in backtest and 0.8 in paper trading. Which number should you believe?",
    hint: "The paper trading number is closer to reality, but even that's optimistic (no real money psychology, possibly smaller size than you'd actually trade). Expect live performance to be worse than paper trading. The backtest number is essentially fiction."
  },
  {
    question: "You're backtesting a strategy that trades once per month. Someone else is testing one that trades 100 times per day. Whose backtest is more reliable?",
    hint: "The monthly trader's, probably. The high-frequency backtest requires millisecond-accurate data, realistic bid-ask spreads, queue position modeling, and market impact estimation. Most HFT backtests are wildly optimistic because these are hard to model."
  }
]} />
